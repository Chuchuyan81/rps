<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="–ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∏–≥—Ä–∞ –ö–∞–º–µ–Ω—å, –ù–æ–∂–Ω–∏—Ü—ã, –ë—É–º–∞–≥–∞ –æ–Ω–ª–∞–π–Ω –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏" />
  <meta name="keywords" content="–∏–≥—Ä–∞, –∫–∞–º–µ–Ω—å –Ω–æ–∂–Ω–∏—Ü—ã –±—É–º–∞–≥–∞, –æ–Ω–ª–∞–π–Ω, –º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è, PWA" />
  <meta name="author" content="RPS Game" />
  
  <!-- PWA –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ -->
  <meta name="theme-color" content="#6366f1" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="RPS Game" />
  <meta name="application-name" content="–ö–∞–º–µ–Ω—å, –ù–æ–∂–Ω–∏—Ü—ã, –ë—É–º–∞–≥–∞" />
  <meta name="msapplication-TileColor" content="#6366f1" />
  <meta name="msapplication-navbutton-color" content="#6366f1" />
  
  <!-- Open Graph –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="–ö–∞–º–µ–Ω—å, –ù–æ–∂–Ω–∏—Ü—ã, –ë—É–º–∞–≥–∞ - –û–Ω–ª–∞–π–Ω –∏–≥—Ä–∞" />
  <meta property="og:description" content="–ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∏–≥—Ä–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∫–æ–º–Ω–∞—Ç—ã –∏ –∏–≥—Ä–∞–π—Ç–µ —Å –¥—Ä—É–∑—å—è–º–∏!" />
  <meta property="og:image" content="/icons/icon-512x512.png" />
  <meta property="og:url" content="/" />
  <meta property="og:site_name" content="RPS Game" />
  
  <!-- Twitter –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="–ö–∞–º–µ–Ω—å, –ù–æ–∂–Ω–∏—Ü—ã, –ë—É–º–∞–≥–∞" />
  <meta name="twitter:description" content="–ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∏–≥—Ä–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏" />
  <meta name="twitter:image" content="/icons/icon-512x512.png" />
  
  <title>–ö–∞–º–µ–Ω—å, –ù–æ–∂–Ω–∏—Ü—ã, –ë—É–º–∞–≥–∞ - PWA –ò–≥—Ä–∞</title>
  
  <!-- PWA –º–∞–Ω–∏—Ñ–µ—Å—Ç -->
  <link rel="manifest" href="/manifest.json" />
  
  <!-- –ò–∫–æ–Ω–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ -->
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-16x16.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-180x180.png" />
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png" />
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png" />
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/icon-120x120.png" />
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/icon-114x114.png" />
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/icon-76x76.png" />
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png" />
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/icon-60x60.png" />
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/icon-57x57.png" />
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  
  <!-- –°—Ç–∏–ª–∏ -->
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–Ω -->
  <div class="background-animation">
    <div class="floating-shapes">
      <div class="shape shape-1"></div>
      <div class="shape shape-2"></div>
      <div class="shape shape-3"></div>
      <div class="shape shape-4"></div>
      <div class="shape shape-5"></div>
    </div>
  </div>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
  <div class="app-container">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <header class="app-header">
      <div class="header-content">
        <div class="logo-section">
          <div class="logo-icon">
            <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
              <circle cx="16" cy="16" r="16" fill="url(#logo-gradient)"/>
              <path d="M22 12L14 20L10 16" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <defs>
                <linearGradient id="logo-gradient" x1="0" y1="0" x2="32" y2="32">
                  <stop stop-color="#6366f1"/>
                  <stop offset="1" stop-color="#8b5cf6"/>
                </linearGradient>
              </defs>
            </svg>
          </div>
          <div class="logo-text">
            <h1 class="app-title">–ö–∞–º–µ–Ω—å, –ù–æ–∂–Ω–∏—Ü—ã, –ë—É–º–∞–≥–∞</h1>
            <p class="app-subtitle">–û–Ω–ª–∞–π–Ω –∏–≥—Ä–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
          </div>
        </div>
        
        <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è -->
        <div class="connection-status" id="connectionStatus">
          <div class="status-indicator online" id="statusIndicator"></div>
          <span class="status-text" id="statusText">–û–Ω–ª–∞–π–Ω</span>
        </div>
      </div>
    </header>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–≥—Ä–æ–≤–∞—è –æ–±–ª–∞—Å—Ç—å -->
    <main class="game-main">
      <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –∏–≥—Ä—ã -->
      <div class="game-card" id="gameCard">
        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è -->
        <div class="progress-bar">
          <div class="progress-step active" data-step="room">
            <div class="step-number">1</div>
            <span class="step-label">–ö–æ–º–Ω–∞—Ç–∞</span>
          </div>
          <div class="progress-connector"></div>
          <div class="progress-step" data-step="waiting">
            <div class="step-number">2</div>
            <span class="step-label">–û–∂–∏–¥–∞–Ω–∏–µ</span>
          </div>
          <div class="progress-connector"></div>
          <div class="progress-step" data-step="playing">
            <div class="step-number">3</div>
            <span class="step-label">–ò–≥—Ä–∞</span>
          </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–Ω–∞—Ç–æ–π -->
        <section class="room-section" id="roomSection">
          <div class="section-header">
            <h2 class="section-title">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∏–≥—Ä–µ</h2>
            <p class="section-description">–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –∫–æ–º–Ω–∞—Ç—É –∏–ª–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç–µ—Å—å –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π</p>
          </div>

          <div class="room-controls">
            <div class="input-group">
              <label for="roomInput" class="input-label">ID –∫–æ–º–Ω–∞—Ç—ã</label>
              <div class="input-container">
                <input 
                  type="text" 
                  id="roomInput" 
                  class="room-input"
                  placeholder="1234" 
                  oninput="updateButton()" 
                  maxlength="4"
                  pattern="[0-9]*"
                  autocomplete="off"
                  inputmode="numeric"
                  aria-describedby="room-help"
                />
                <div class="input-suffix">
                  <button type="button" class="input-clear" id="clearButton" onclick="clearInput()" aria-label="–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª–µ">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                      <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                  </button>
                </div>
              </div>
              <div class="input-help" id="room-help">–í–≤–µ–¥–∏—Ç–µ 4-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ –∫–æ–º–Ω–∞—Ç—ã –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é</div>
            </div>

            <div class="action-buttons">
              <button id="actionButton" onclick="handleAction()" class="primary-button">
                <span class="button-content">
                  <svg class="button-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M10 4V16M4 10H16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                  <span class="button-text">–°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</span>
                </span>
                <div class="button-ripple"></div>
              </button>
              
              <button class="secondary-button" onclick="showRandomRoomDialog()">
                <span class="button-content">
                  <svg class="button-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M16 4L4 16M8 4L16 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                  <span class="button-text">–°–ª—É—á–∞–π–Ω–∞—è –∏–≥—Ä–∞</span>
                </span>
              </button>
            </div>
          </div>
        </section>

        <!-- –°–µ–∫—Ü–∏—è –æ–∂–∏–¥–∞–Ω–∏—è –æ–ø–ø–æ–Ω–µ–Ω—Ç–∞ -->
        <section class="waiting-section" id="waitingSection" style="display: none;">
          <div class="waiting-content">
            <div class="waiting-animation">
              <div class="pulse-loader">
                <div class="pulse-dot"></div>
                <div class="pulse-dot"></div>
                <div class="pulse-dot"></div>
              </div>
            </div>
            <h3 class="waiting-title">–û–∂–∏–¥–∞–Ω–∏–µ –æ–ø–ø–æ–Ω–µ–Ω—Ç–∞</h3>
            <p class="waiting-description">–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –∫–æ–¥–æ–º –∫–æ–º–Ω–∞—Ç—ã —Å –¥—Ä—É–≥–æ–º</p>
            <div class="room-code-display">
              <span class="room-code" id="roomCodeDisplay">----</span>
              <button class="copy-button" onclick="copyRoomCode()" aria-label="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                  <path d="M4 4H12V12H4V4Z" stroke="currentColor" stroke-width="1.5" fill="none"/>
                  <path d="M8 2H14V8" stroke="currentColor" stroke-width="1.5" fill="none"/>
                </svg>
              </button>
            </div>
            
            <button class="secondary-button" onclick="fullCleanup()" style="margin-top: 20px;">
              <span class="button-content">
                <svg class="button-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                  <path d="M15 5L5 15M5 5L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <span class="button-text">–ó–∞–∫–æ–Ω—á–∏—Ç—å –∏–≥—Ä—É</span>
              </span>
            </button>
          </div>
        </section>

        <!-- –°–µ–∫—Ü–∏—è –∏–≥—Ä–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ -->
        <section class="game-section" id="gameSection" style="display: none;">
          <div class="game-header">
            <h3 class="game-title">–°–¥–µ–ª–∞–π—Ç–µ –≤–∞—à –≤—ã–±–æ—Ä</h3>
            <div class="game-timer" id="gameTimer">
              <div class="timer-circle">
                <svg width="40" height="40" viewBox="0 0 40 40">
                  <circle cx="20" cy="20" r="18" fill="none" stroke="#e5e7eb" stroke-width="2"/>
                  <circle cx="20" cy="20" r="18" fill="none" stroke="#6366f1" stroke-width="2" 
                          stroke-dasharray="113" stroke-dashoffset="113" class="timer-progress"/>
                </svg>
                <span class="timer-text">30</span>
              </div>
            </div>
          </div>

          <div class="choices-grid">
            <button class="choice-card" onclick="makeMove('–∫–∞–º–µ–Ω—å')" data-choice="rock" aria-label="–í—ã–±—Ä–∞—Ç—å –∫–∞–º–µ–Ω—å">
              <div class="choice-icon">
                <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                  <circle cx="24" cy="24" r="20" fill="currentColor" opacity="0.1"/>
                  <text x="24" y="32" text-anchor="middle" font-size="24">ü™®</text>
                </svg>
              </div>
              <span class="choice-label">–ö–∞–º–µ–Ω—å</span>
              <div class="choice-ripple"></div>
            </button>

            <button class="choice-card" onclick="makeMove('–Ω–æ–∂–Ω–∏—Ü—ã')" data-choice="scissors" aria-label="–í—ã–±—Ä–∞—Ç—å –Ω–æ–∂–Ω–∏—Ü—ã">
              <div class="choice-icon">
                <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                  <circle cx="24" cy="24" r="20" fill="currentColor" opacity="0.1"/>
                  <text x="24" y="32" text-anchor="middle" font-size="24">‚úÇÔ∏è</text>
                </svg>
              </div>
              <span class="choice-label">–ù–æ–∂–Ω–∏—Ü—ã</span>
              <div class="choice-ripple"></div>
            </button>

            <button class="choice-card" onclick="makeMove('–±—É–º–∞–≥–∞')" data-choice="paper" aria-label="–í—ã–±—Ä–∞—Ç—å –±—É–º–∞–≥—É">
              <div class="choice-icon">
                <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                  <circle cx="24" cy="24" r="20" fill="currentColor" opacity="0.1"/>
                  <text x="24" y="32" text-anchor="middle" font-size="24">üìÑ</text>
                </svg>
              </div>
              <span class="choice-label">–ë—É–º–∞–≥–∞</span>
              <div class="choice-ripple"></div>
            </button>
          </div>

          <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤—ã–±–æ—Ä–æ–≤ –∏–≥—Ä–æ–∫–æ–≤ -->
          <div class="players-status">
            <div class="player-card">
              <div class="player-avatar">
                <div class="avatar-circle">–í—ã</div>
              </div>
              <div class="player-choice" id="myChoiceDisplay">
                <div class="choice-placeholder">?</div>
              </div>
            </div>

            <div class="vs-separator">
              <span class="vs-text">VS</span>
            </div>

            <div class="player-card">
              <div class="player-avatar">
                <div class="avatar-circle">–û–ø–ø–æ–Ω–µ–Ω—Ç</div>
              </div>
              <div class="player-choice" id="opponentChoiceDisplay">
                <div class="choice-placeholder">?</div>
              </div>
            </div>
          </div>
          
          <div class="game-actions" style="margin-top: 20px; text-align: center;">
            <button class="secondary-button" onclick="fullCleanup()">
              <span class="button-content">
                <svg class="button-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                  <path d="M15 5L5 15M5 5L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <span class="button-text">–ó–∞–∫–æ–Ω—á–∏—Ç—å –∏–≥—Ä—É</span>
              </span>
            </button>
          </div>
        </section>

        <!-- –û–±–ª–∞—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
        <div class="result-section" id="resultSection">
          <div class="status-message" id="statusMessage" role="status" aria-live="polite">
            –ì–æ—Ç–æ–≤ –∫ –∏–≥—Ä–µ! –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–º–Ω–∞—Ç—É –∏–ª–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç–µ—Å—å –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π.
          </div>
        </div>
      </div>

      <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π -->
      <aside class="info-sidebar">
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="info-card">
          <h3 class="info-title">–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
          <div class="stats-grid">
            <div class="stat-item">
              <div class="stat-value" id="winsCount">0</div>
              <div class="stat-label">–ü–æ–±–µ–¥</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="lossesCount">0</div>
              <div class="stat-label">–ü–æ—Ä–∞–∂–µ–Ω–∏–π</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="drawsCount">0</div>
              <div class="stat-label">–ù–∏—á—å–∏—Ö</div>
            </div>
          </div>
        </div>

        <!-- –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã -->
        <div class="info-card">
          <h3 class="info-title">–ü—Ä–∞–≤–∏–ª–∞</h3>
          <div class="rules-list">
            <div class="rule-item">
              <span class="rule-emoji">ü™®</span>
              <span class="rule-text">–ö–∞–º–µ–Ω—å –ø–æ–±–µ–∂–¥–∞–µ—Ç –Ω–æ–∂–Ω–∏—Ü—ã</span>
            </div>
            <div class="rule-item">
              <span class="rule-emoji">‚úÇÔ∏è</span>
              <span class="rule-text">–ù–æ–∂–Ω–∏—Ü—ã –ø–æ–±–µ–∂–¥–∞—é—Ç –±—É–º–∞–≥—É</span>
            </div>
            <div class="rule-item">
              <span class="rule-emoji">üìÑ</span>
              <span class="rule-text">–ë—É–º–∞–≥–∞ –ø–æ–±–µ–∂–¥–∞–µ—Ç –∫–∞–º–µ–Ω—å</span>
            </div>
          </div>
        </div>

        <!-- PWA —É—Å—Ç–∞–Ω–æ–≤–∫–∞ -->
        <div class="info-card pwa-card" id="pwaCard">
          <h3 class="info-title">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h3>
          <p class="pwa-description">
            –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∏ —Ä–∞–±–æ—Ç—ã –æ—Ñ–ª–∞–π–Ω
          </p>
          <button id="install-btn" class="install-button" style="display: none;">
            <svg class="button-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M10 2V14M10 14L6 10M10 14L14 10M3 17H17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>–°–∫–∞—á–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</span>
          </button>
        </div>
      </aside>
    </main>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal" id="randomRoomModal">
      <div class="modal-header">
        <h3 class="modal-title">–°–ª—É—á–∞–π–Ω–∞—è –∏–≥—Ä–∞</h3>
        <button class="modal-close" onclick="closeModal()" aria-label="–ó–∞–∫—Ä—ã—Ç—å">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <p>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ —Å–ª—É—á–∞–π–Ω–æ–π –∏–≥—Ä–µ —Å –¥—Ä—É–≥–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏?</p>
      </div>
      <div class="modal-footer">
        <button class="secondary-button" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
        <button class="primary-button" onclick="findRandomGame()">–ù–∞–π—Ç–∏ –∏–≥—Ä—É</button>
      </div>
    </div>
  </div>

  <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Supabase -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script> 
  <script src="script.js"></script>
  
  <!-- PWA Service Worker -->
  <script>
    // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker –¥–ª—è PWA —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', async () => {
        try {
          const registration = await navigator.serviceWorker.register('/sw.js');
          console.log('‚úÖ Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', registration.scope);
          
          // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π SW
          registration.addEventListener('updatefound', () => {
            const newWorker = registration.installing;
            newWorker.addEventListener('statechange', () => {
              if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                // –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞
                showUpdateToast();
              }
            });
          });
          
        } catch (error) {
          console.error('‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker:', error);
        }
      });

      // –°–ª—É—à–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç Service Worker
      navigator.serviceWorker.addEventListener('message', (event) => {
        if (event.data && event.data.type === 'SW_UPDATED') {
          console.log('üîÑ Service Worker –æ–±–Ω–æ–≤–ª–µ–Ω');
        }
      });
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PWA
    let deferredPrompt;
    let installBtn;
    
    // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
    function isMobileDevice() {
      return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
             (navigator.maxTouchPoints && navigator.maxTouchPoints > 2 && /MacIntel/.test(navigator.platform));
    }
    
    // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ PWA —Ä–µ–∂–∏–º–∞
    function isPWAInstalled() {
      return window.matchMedia('(display-mode: standalone)').matches ||
             window.navigator.standalone === true ||
             document.referrer.includes('android-app://');
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
    function initInstallButton() {
      installBtn = document.getElementById('install-btn');
      if (!installBtn) return;
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Ç–æ–ª—å–∫–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –∏ –µ—Å–ª–∏ PWA –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
      if (isMobileDevice() && !isPWAInstalled()) {
        console.log('üì± –ú–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ, –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É PWA');
        
        // –î–ª—è iOS –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Å—Ä–∞–∑—É
        showIOSInstallPrompt();
        
        // –î–ª—è Android –∫–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∂–µ—Ç—Å—è –ø—Ä–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏ beforeinstallprompt
      }
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è iOS —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (Safari)
    function showIOSInstallPrompt() {
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –≤—Å–µ—Ö –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
      if (!isPWAInstalled() && installBtn) {
        installBtn.style.display = 'flex';
        
        // –î–ª—è iOS –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
        if (navigator.userAgent.includes('iPhone') || navigator.userAgent.includes('iPad')) {
          installBtn.onclick = () => {
            showIOSInstructions();
          };
        }
        // –î–ª—è Android –∫–Ω–æ–ø–∫–∞ –±—É–¥–µ—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ beforeinstallprompt
      }
    }
    
    // –ü–æ–∫–∞–∑ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –¥–ª—è iOS
    function showIOSInstructions() {
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        padding: 20px;
        box-sizing: border-box;
      `;
      
      modal.innerHTML = `
        <div style="
          background: white;
          border-radius: 20px;
          padding: 30px;
          max-width: 350px;
          text-align: center;
          box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        ">
          <h3 style="margin: 0 0 20px 0; color: #333;">üì± –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h3>
          <div style="text-align: left; margin: 20px 0; line-height: 1.6; color: #666;">
            <p style="margin: 10px 0;"><strong>1.</strong> –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" (üì§) –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞</p>
            <p style="margin: 10px 0;"><strong>2.</strong> –í—ã–±–µ—Ä–∏—Ç–µ "–ù–∞ —ç–∫—Ä–∞–Ω –î–æ–º–æ–π" –∏–ª–∏ "Add to Home Screen"</p>
            <p style="margin: 10px 0;"><strong>3.</strong> –ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å"</p>
            <p style="margin: 20px 0 0 0; text-align: center; color: #28a745; font-weight: bold;">
              üéâ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ—è–≤–∏—Ç—Å—è –Ω–∞ —Ä–∞–±–æ—á–µ–º —Å—Ç–æ–ª–µ!
            </p>
          </div>
          <button onclick="this.parentElement.parentElement.remove()" style="
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
          ">–ü–æ–Ω—è—Ç–Ω–æ</button>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
      modal.onclick = (e) => {
        if (e.target === modal) {
          modal.remove();
        }
      };
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è beforeinstallprompt –¥–ª—è Android/Chrome
    window.addEventListener('beforeinstallprompt', (e) => {
      console.log('üíæ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å (Android/Chrome)');
      e.preventDefault();
      deferredPrompt = e;
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Ç–æ–ª—å–∫–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
      if (isMobileDevice() && installBtn) {
        installBtn.style.display = 'flex';
        installBtn.onclick = async () => {
          installBtn.style.display = 'none';
          try {
            await deferredPrompt.prompt();
            const choiceResult = await deferredPrompt.userChoice;
            if (choiceResult.outcome === 'accepted') {
              console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å—Ç–∞–Ω–æ–≤–∏–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ');
              // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, —Ç–∞–∫ –∫–∞–∫ showToast –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
              alert('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!');
            } else {
              console.log('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª–æ–Ω–∏–ª —É—Å—Ç–∞–Ω–æ–≤–∫—É');
            }
          } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ:', error);
          }
          deferredPrompt = null;
        };
      }
    });
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', initInstallButton);

    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
    window.addEventListener('appinstalled', (e) => {
      console.log('üéâ PWA –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!');
      // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —É—Å—Ç–∞–Ω–æ–≤–∫–∏
      const installBtn = document.getElementById('install-btn');
      if (installBtn) {
        installBtn.style.display = 'none';
      }
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      alert('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!');
    });

    // –ü–æ–∫–∞–∑ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    window.addEventListener('online', () => {
      console.log('üåê –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
      updateConnectionStatus(true);
    });

    window.addEventListener('offline', () => {
      console.log('üì° –†–∞–±–æ—Ç–∞ –≤ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–µ');
      updateConnectionStatus(false);
    });
  </script>
</body>
</html>
