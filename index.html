<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ö–∞–º–µ–Ω—å, –ù–æ–∂–Ω–∏—Ü—ã, –ë—É–º–∞–≥–∞ - –û–Ω–ª–∞–π–Ω –∏–≥—Ä–∞</title>
  
  <!-- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: Content Security Policy -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://kdbbyqsdmucjvsatbiog.supabase.co https://unpkg.com https://fonts.googleapis.com https://fonts.gstatic.com; script-src 'self' 'unsafe-inline' https://unpkg.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data:; connect-src 'self' https://kdbbyqsdmucjvsatbiog.supabase.co wss://*.supabase.co;">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="X-Frame-Options" content="DENY">
  <meta http-equiv="X-XSS-Protection" content="1; mode=block">
  <meta name="referrer" content="strict-origin-when-cross-origin">
  
  <!-- SEO –º–µ—Ç–∞-—Ç–µ–≥–∏ -->
  <meta name="description" content="–ò–≥—Ä–∞–π—Ç–µ –≤ –∫–∞–º–µ–Ω—å, –Ω–æ–∂–Ω–∏—Ü—ã, –±—É–º–∞–≥–∞ –æ–Ω–ª–∞–π–Ω —Å –¥—Ä—É–∑—å—è–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∫–æ–º–Ω–∞—Ç—ã –∏ —Å–æ—Ä–µ–≤–Ω—É–π—Ç–µ—Å—å!">
  <meta name="keywords" content="–∫–∞–º–µ–Ω—å –Ω–æ–∂–Ω–∏—Ü—ã –±—É–º–∞–≥–∞, –æ–Ω–ª–∞–π–Ω –∏–≥—Ä–∞, –∏–≥—Ä–∞ —Å –¥—Ä—É–∑—å—è–º–∏, rock paper scissors">
  <meta name="author" content="RPS Game">
  
  <!-- Open Graph -->
  <meta property="og:title" content="–ö–∞–º–µ–Ω—å, –ù–æ–∂–Ω–∏—Ü—ã, –ë—É–º–∞–≥–∞ - –û–Ω–ª–∞–π–Ω">
  <meta property="og:description" content="–ò–≥—Ä–∞–π—Ç–µ –≤ –∫–∞–º–µ–Ω—å, –Ω–æ–∂–Ω–∏—Ü—ã, –±—É–º–∞–≥–∞ –æ–Ω–ª–∞–π–Ω —Å –¥—Ä—É–∑—å—è–º–∏">
  <meta property="og:type" content="website">
      <meta property="og:image" content="/icons/icon-192x192.png">
  
  <!-- PWA –º–µ—Ç–∞-—Ç–µ–≥–∏ -->
  <meta name="theme-color" content="#6366f1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="RPS Game">
  
      <!-- Favicon –∏ –∏–∫–æ–Ω–∫–∏ -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="48x48" href="icons/icon-48x48.png">
    <link rel="apple-touch-icon" sizes="192x192" href="icons/icon-192x192.png">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
  <link rel="manifest" href="manifest.json">
  
  <!-- –®—Ä–∏—Ñ—Ç—ã -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- –°—Ç–∏–ª–∏ -->
  <link rel="stylesheet" href="style.css">
  
  <!-- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è -->
  <script src="config.js"></script>
  <script>
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    if (!window.CONFIG_LOADED) {
      console.warn('‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: config.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.');
    }
  </script>
</head>

<body>
  <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
  <div class="game-screen" id="gameScreen">
    <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å —Å –∏–∫–æ–Ω–∫–∞–º–∏ -->
    <div class="top-bar">
      <div class="top-left">
        <button class="icon-btn" id="menuBtn" onclick="toggleMenu()" aria-label="–ú–µ–Ω—é">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M3 12H21M3 6H21M3 18H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
        <div class="room-info" id="roomInfo" style="display: none;">
          <span class="room-code-mini" id="roomCodeMini">----</span>
        </div>
      </div>
      
      <div class="top-right">
        <div class="connection-dot" id="connectionDot"></div>
        <button class="icon-btn" id="exitBtn" onclick="fullCleanup()" style="display: none;" aria-label="–í—ã—Ö–æ–¥">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ -->
    <div class="game-field">
      <!-- –°–µ–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–Ω–∞—Ç—ã -->
      <div class="game-state" id="roomState">
        <div class="center-content">
          <div class="game-logo">üéÆ</div>
          <h1 class="game-title">–ö–∞–º–µ–Ω—å –ù–æ–∂–Ω–∏—Ü—ã –ë—É–º–∞–≥–∞</h1>
          
          <div class="room-input-container">
            <input 
              type="text" 
              id="roomInput" 
              class="room-input-field"
              placeholder="–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã" 
              oninput="updateButton()" 
              maxlength="4"
              pattern="[0-9]*"
              autocomplete="off"
              inputmode="numeric"
              spellcheck="false"
              data-lpignore="true"
              required
            />
            <button class="clear-btn" onclick="clearInput()" aria-label="–û—á–∏—Å—Ç–∏—Ç—å">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </button>
          </div>
          
          <div class="action-buttons">
            <button id="actionButton" onclick="handleAction()" class="primary-btn">
              <span class="btn-text">–°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</span>
            </button>
            <button class="secondary-btn" onclick="showAvailableRooms()">
              <span class="btn-text">–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã</span>
            </button>
          </div>
        </div>
      </div>

      <!-- –°–µ–∫—Ü–∏—è –æ–∂–∏–¥–∞–Ω–∏—è -->
      <div class="game-state" id="waitingState" style="display: none;">
        <div class="center-content">
          <div class="waiting-animation">
            <div class="pulse-dots">
              <div class="dot"></div>
              <div class="dot"></div>
              <div class="dot"></div>
            </div>
          </div>
          <h2 class="state-title">–û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–∞</h2>
          <div class="room-code-big" id="roomCodeBig">----</div>
          <p class="state-description">–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –∫–æ–¥–æ–º —Å –¥—Ä—É–≥–æ–º</p>
          <button class="copy-btn" onclick="copyRoomCode()">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M4 4H12V12H4V4Z" stroke="currentColor" stroke-width="1.5" fill="none"/>
              <path d="M8 2H14V8" stroke="currentColor" stroke-width="1.5" fill="none"/>
            </svg>
            –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
          </button>
        </div>
      </div>

      <!-- –°–µ–∫—Ü–∏—è –∏–≥—Ä—ã -->
      <div class="game-state" id="playingState" style="display: none;">
        <!-- –°—Ç–∞—Ç—É—Å –∏–≥—Ä–æ–∫–æ–≤ -->
        <div class="players-area">
          <div class="player-status">
            <div class="player-avatar">
              <div class="avatar">–í—ã</div>
            </div>
            <div class="player-choice" id="myChoice">
              <div class="choice-placeholder">?</div>
            </div>
            <div class="player-status-text" id="myStatus">–í–∞—à —Ö–æ–¥</div>
          </div>
          
          <div class="vs-divider">
            <span class="vs-text">VS</span>
          </div>
          
          <div class="player-status">
            <div class="player-avatar">
              <div class="avatar">–û–ø–ø–æ–Ω–µ–Ω—Ç</div>
            </div>
            <div class="player-choice" id="opponentChoice">
              <div class="choice-placeholder">?</div>
            </div>
            <div class="player-status-text" id="opponentStatus">–û–∂–∏–¥–∞–Ω–∏–µ</div>
          </div>
        </div>

        <!-- –í—ã–±–æ—Ä —Ö–æ–¥–∞ -->
        <div class="choices-area">
          <button class="choice-btn" onclick="makeMove('–∫–∞–º–µ–Ω—å')" data-choice="rock">
            <div class="choice-emoji">ü™®</div>
            <span class="choice-name">–ö–∞–º–µ–Ω—å</span>
          </button>
          <button class="choice-btn" onclick="makeMove('–Ω–æ–∂–Ω–∏—Ü—ã')" data-choice="scissors">
            <div class="choice-emoji">‚úÇÔ∏è</div>
            <span class="choice-name">–ù–æ–∂–Ω–∏—Ü—ã</span>
          </button>
          <button class="choice-btn" onclick="makeMove('–±—É–º–∞–≥–∞')" data-choice="paper">
            <div class="choice-emoji">üìÑ</div>
            <span class="choice-name">–ë—É–º–∞–≥–∞</span>
          </button>
        </div>
      </div>
    </div>

    <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é -->
    <div class="side-menu" id="sideMenu">
      <div class="menu-header">
        <h3>–ú–µ–Ω—é</h3>
        <button class="close-menu-btn" onclick="toggleMenu()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
      
      <div class="menu-content">
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="menu-section">
          <h4>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä</h4>
          <div class="stats-compact">
            <div class="stat-item">
              <span class="stat-number" id="winsCount">0</span>
              <span class="stat-text">–ü–æ–±–µ–¥</span>
            </div>
            <div class="stat-item">
              <span class="stat-number" id="lossesCount">0</span>
              <span class="stat-text">–ü–æ—Ä–∞–∂–µ–Ω–∏–π</span>
            </div>
            <div class="stat-item">
              <span class="stat-number" id="drawsCount">0</span>
              <span class="stat-text">–ù–∏—á—å–∏—Ö</span>
            </div>
          </div>
          <button class="reset-stats-btn" onclick="resetStats()">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
              <path d="M3 8C3 5.24 5.24 3 8 3C10.76 3 13 5.24 13 8C13 10.76 10.76 13 8 13C6.12 13 4.5 11.95 3.85 10.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
              <path d="M3 6V10H7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            –°–±—Ä–æ—Å–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
          </button>
        </div>

        <!-- –ö–∞–∫ –∏–≥—Ä–∞—Ç—å -->
        <div class="menu-section">
          <h4>–ö–∞–∫ –∏–≥—Ä–∞—Ç—å</h4>
          <div class="how-to-play">
            <p class="description-text">
              ‚Ä¢ –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–º–Ω–∞—Ç—É –∏–ª–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç–µ—Å—å –ø–æ –∫–æ–¥—É<br>
              ‚Ä¢ –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–º–µ–Ω—å, –Ω–æ–∂–Ω–∏—Ü—ã –∏–ª–∏ –±—É–º–∞–≥—É<br>
              ‚Ä¢ –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫–æ–≥–¥–∞ –æ–±–∞ –∏–≥—Ä–æ–∫–∞ —Å–¥–µ–ª–∞—é—Ç —Ö–æ–¥<br>
              ‚Ä¢ –ò–≥—Ä–∞–π—Ç–µ —Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ —Ä–∞—É–Ω–¥–æ–≤!
            </p>
          </div>
        </div>

        <!-- –ü—Ä–∞–≤–∏–ª–∞ -->
        <div class="menu-section">
          <h4>–ü—Ä–∞–≤–∏–ª–∞ –ø–æ–±–µ–¥—ã</h4>
          <div class="rules-compact">
            <div class="rule-item">ü™® –ø–æ–±–µ–∂–¥–∞–µ—Ç ‚úÇÔ∏è</div>
            <div class="rule-item">‚úÇÔ∏è –ø–æ–±–µ–∂–¥–∞–µ—Ç üìÑ</div>
            <div class="rule-item">üìÑ –ø–æ–±–µ–∂–¥–∞–µ—Ç ü™®</div>
            <div class="rule-item">–û–¥–∏–Ω–∞–∫–æ–≤—ã–π –≤—ã–±–æ—Ä = –Ω–∏—á—å—è</div>
          </div>
        </div>

        <!-- PWA -->
        <div class="menu-section" id="pwaSection">
          <h4>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h4>
          <div class="pwa-description">
            <p class="description-text">
              –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏–≥—Ä—É –∫–∞–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ —Å–≤–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:
            </p>
            <div class="pwa-benefits">
              ‚Ä¢ –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞<br>
              ‚Ä¢ –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞<br>
              ‚Ä¢ –ó–∞–ø—É—Å–∫ —Å —Ä–∞–±–æ—á–µ–≥–æ —Å—Ç–æ–ª–∞<br>
              ‚Ä¢ –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º
            </div>
          </div>
          <button id="install-btn" class="install-btn" style="display: none;">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M10 2V14M10 14L6 10M10 14L14 10M3 17H17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
          </button>
        </div>
      </div>
    </div>

    <!-- –û–≤–µ—Ä–ª–µ–π –¥–ª—è –º–µ–Ω—é -->
    <div class="menu-overlay" id="menuOverlay" onclick="toggleMenu()"></div>

    <!-- –°—Ç–∞—Ç—É—Å —Å–æ–æ–±—â–µ–Ω–∏–µ -->
    <div class="status-bar" id="statusBar">
      <span id="statusMessage">–ì–æ—Ç–æ–≤ –∫ –∏–≥—Ä–µ!</span>
    </div>
  </div>

  <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Supabase -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script> 
  <script src="script.js"></script>
  
  <!-- PWA Service Worker -->
  <script>
    // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker –¥–ª—è PWA —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', async () => {
        try {
          const registration = await navigator.serviceWorker.register('sw.js');
          console.log('‚úÖ Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', registration.scope);
          
          // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π SW
          registration.addEventListener('updatefound', () => {
            const newWorker = registration.installing;
            newWorker.addEventListener('statechange', () => {
              if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                // –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞
                showUpdateToast();
              }
            });
          });
          
        } catch (error) {
          console.error('‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker:', error);
        }
      });

      // –°–ª—É—à–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç Service Worker
      navigator.serviceWorker.addEventListener('message', (event) => {
        if (event.data && event.data.type === 'SW_UPDATED') {
          console.log('üîÑ Service Worker –æ–±–Ω–æ–≤–ª–µ–Ω');
        }
      });
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PWA
    let deferredPrompt;
    let installBtn;
    
    // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
    function isMobileDevice() {
      return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
             (navigator.maxTouchPoints && navigator.maxTouchPoints > 2 && /MacIntel/.test(navigator.platform));
    }
    
    // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ PWA —Ä–µ–∂–∏–º–∞
    function isPWAInstalled() {
      return window.matchMedia('(display-mode: standalone)').matches ||
             window.navigator.standalone === true ||
             document.referrer.includes('android-app://');
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
    function initInstallButton() {
      installBtn = document.getElementById('install-btn');
      if (!installBtn) return;
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Ç–æ–ª—å–∫–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –∏ –µ—Å–ª–∏ PWA –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
      if (isMobileDevice() && !isPWAInstalled()) {
        console.log('üì± –ú–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ, –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É PWA');
        
        // –î–ª—è iOS –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Å—Ä–∞–∑—É
        showIOSInstallPrompt();
        
        // –î–ª—è Android –∫–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∂–µ—Ç—Å—è –ø—Ä–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏ beforeinstallprompt
      }
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è iOS —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (Safari)
    function showIOSInstallPrompt() {
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –≤—Å–µ—Ö –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
      if (!isPWAInstalled() && installBtn) {
        installBtn.style.display = 'flex';
        
        // –î–ª—è iOS –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
        if (navigator.userAgent.includes('iPhone') || navigator.userAgent.includes('iPad')) {
          installBtn.onclick = () => {
            showIOSInstructions();
          };
        }
        // –î–ª—è Android –∫–Ω–æ–ø–∫–∞ –±—É–¥–µ—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ beforeinstallprompt
      } else {
        // –î–ª—è Android –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∏ –∂–¥–µ–º prompt
        installBtn.onclick = () => {
          showToast("–û–∂–∏–¥–∞–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏...", 'info');
        };
      }
    }
    
    // –ü–æ–∫–∞–∑ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –¥–ª—è iOS
    function showIOSInstructions() {
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        padding: 20px;
        box-sizing: border-box;
      `;
      
      modal.innerHTML = `
        <div style="
          background: white;
          border-radius: 20px;
          padding: 30px;
          max-width: 350px;
          text-align: center;
          box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        ">
          <h3 style="margin: 0 0 20px 0; color: #333;">üì± –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h3>
          <div style="text-align: left; margin: 20px 0; line-height: 1.6; color: #666;">
            <p style="margin: 10px 0;"><strong>1.</strong> –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" (üì§) –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞</p>
            <p style="margin: 10px 0;"><strong>2.</strong> –í—ã–±–µ—Ä–∏—Ç–µ "–ù–∞ —ç–∫—Ä–∞–Ω –î–æ–º–æ–π" –∏–ª–∏ "Add to Home Screen"</p>
            <p style="margin: 10px 0;"><strong>3.</strong> –ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å"</p>
            <p style="margin: 20px 0 0 0; text-align: center; color: #28a745; font-weight: bold;">
              üéâ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ—è–≤–∏—Ç—Å—è –Ω–∞ —Ä–∞–±–æ—á–µ–º —Å—Ç–æ–ª–µ!
            </p>
          </div>
          <button onclick="this.parentElement.parentElement.remove()" style="
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
          ">–ü–æ–Ω—è—Ç–Ω–æ</button>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
      modal.onclick = (e) => {
        if (e.target === modal) {
          modal.remove();
        }
      };
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è beforeinstallprompt –¥–ª—è Android/Chrome
    window.addEventListener('beforeinstallprompt', (e) => {
      console.log('üíæ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å (Android/Chrome)');
      e.preventDefault();
      deferredPrompt = e;
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Ç–æ–ª—å–∫–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
      if (isMobileDevice() && installBtn) {
        installBtn.style.display = 'flex';
        installBtn.onclick = async () => {
          installBtn.style.display = 'none';
          try {
            await deferredPrompt.prompt();
            const choiceResult = await deferredPrompt.userChoice;
            if (choiceResult.outcome === 'accepted') {
              console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å—Ç–∞–Ω–æ–≤–∏–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ');
              // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, —Ç–∞–∫ –∫–∞–∫ showToast –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
              alert('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!');
            } else {
              console.log('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª–æ–Ω–∏–ª —É—Å—Ç–∞–Ω–æ–≤–∫—É');
            }
                      } catch (error) {
              console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ:', error);
              alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è');
            }
          deferredPrompt = null;
        };
      }
    });
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', initInstallButton);

    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
    window.addEventListener('appinstalled', (e) => {
      console.log('üéâ PWA –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!');
      // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —É—Å—Ç–∞–Ω–æ–≤–∫–∏
      const installBtn = document.getElementById('install-btn');
      if (installBtn) {
        installBtn.style.display = 'none';
      }
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      alert('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!');
    });

    // –ü–æ–∫–∞–∑ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    window.addEventListener('online', () => {
      console.log('üåê –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
      updateConnectionStatus(true);
    });

    window.addEventListener('offline', () => {
      console.log('üì° –†–∞–±–æ—Ç–∞ –≤ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–µ');
      updateConnectionStatus(false);
    });
  </script>
</body>
</html>
