<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="–ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∏–≥—Ä–∞ –ö–∞–º–µ–Ω—å, –ù–æ–∂–Ω–∏—Ü—ã, –ë—É–º–∞–≥–∞ –æ–Ω–ª–∞–π–Ω –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏" />
  <meta name="keywords" content="–∏–≥—Ä–∞, –∫–∞–º–µ–Ω—å –Ω–æ–∂–Ω–∏—Ü—ã –±—É–º–∞–≥–∞, –æ–Ω–ª–∞–π–Ω, –º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è, PWA" />
  <meta name="author" content="RPS Game" />
  
  <!-- PWA –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ -->
  <meta name="theme-color" content="#16213e" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="RPS Game" />
  <meta name="application-name" content="–ö–∞–º–µ–Ω—å, –ù–æ–∂–Ω–∏—Ü—ã, –ë—É–º–∞–≥–∞" />
  <meta name="msapplication-TileColor" content="#1a1a2e" />
  <meta name="msapplication-navbutton-color" content="#16213e" />
  
  <!-- Open Graph –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="–ö–∞–º–µ–Ω—å, –ù–æ–∂–Ω–∏—Ü—ã, –ë—É–º–∞–≥–∞ - –û–Ω–ª–∞–π–Ω –∏–≥—Ä–∞" />
  <meta property="og:description" content="–ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∏–≥—Ä–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∫–æ–º–Ω–∞—Ç—ã –∏ –∏–≥—Ä–∞–π—Ç–µ —Å –¥—Ä—É–∑—å—è–º–∏!" />
  <meta property="og:image" content="/icons/icon-512x512.png" />
  <meta property="og:url" content="/" />
  <meta property="og:site_name" content="RPS Game" />
  
  <!-- Twitter –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="–ö–∞–º–µ–Ω—å, –ù–æ–∂–Ω–∏—Ü—ã, –ë—É–º–∞–≥–∞" />
  <meta name="twitter:description" content="–ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∏–≥—Ä–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏" />
  <meta name="twitter:image" content="/icons/icon-512x512.png" />
  
  <title>–ö–∞–º–µ–Ω—å, –ù–æ–∂–Ω–∏—Ü—ã, –ë—É–º–∞–≥–∞ - PWA –ò–≥—Ä–∞</title>
  
  <!-- PWA –º–∞–Ω–∏—Ñ–µ—Å—Ç -->
  <link rel="manifest" href="/manifest.json" />
  
  <!-- –ò–∫–æ–Ω–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ -->
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-16x16.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-180x180.png" />
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png" />
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png" />
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/icon-120x120.png" />
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/icon-114x114.png" />
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/icon-76x76.png" />
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png" />
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/icon-60x60.png" />
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/icon-57x57.png" />
  
  <!-- –°—Ç–∏–ª–∏ -->
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1>üéÆ –ö–∞–º–µ–Ω—å, –ù–æ–∂–Ω–∏—Ü—ã, –ë—É–º–∞–≥–∞</h1>
    
    <div id="game" class="game-container">
      <div class="room-controls">
        <input 
          type="text" 
          id="room" 
          placeholder="–í–≤–µ–¥–∏—Ç–µ ID –∫–æ–º–Ω–∞—Ç—ã (4 —Ü–∏—Ñ—Ä—ã)" 
          oninput="updateButton()" 
          maxlength="4"
          pattern="[0-9]*"
          autocomplete="off"
        />
        <button id="actionButton" onclick="handleAction()" class="action-btn">
          –°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É
        </button>
      </div>

      <div class="choices" id="choices" style="display: none;">
        <h3>–°–¥–µ–ª–∞–π—Ç–µ –≤–∞—à –≤—ã–±–æ—Ä:</h3>
        <div class="choice-buttons">
          <button onclick="makeMove('–∫–∞–º–µ–Ω—å')" class="choice-btn" title="–ö–∞–º–µ–Ω—å">
            ü™® –ö–∞–º–µ–Ω—å
          </button>
          <button onclick="makeMove('–Ω–æ–∂–Ω–∏—Ü—ã')" class="choice-btn" title="–ù–æ–∂–Ω–∏—Ü—ã">
            ‚úÇÔ∏è –ù–æ–∂–Ω–∏—Ü—ã
          </button>
          <button onclick="makeMove('–±—É–º–∞–≥–∞')" class="choice-btn" title="–ë—É–º–∞–≥–∞">
            üìÑ –ë—É–º–∞–≥–∞
          </button>
        </div>
      </div>
      
      <div id="result" class="result"></div>
      
      <div class="game-info">
        <p class="info-text">
          üí° <strong>–ö–∞–∫ –∏–≥—Ä–∞—Ç—å:</strong> –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–º–Ω–∞—Ç—É (–ø–æ–ª—É—á–∏—Ç–µ ID –∏–∑ 4 —Ü–∏—Ñ—Ä) –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ ID —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–æ–º–Ω–∞—Ç—ã. 
          –ö–æ–≥–¥–∞ –æ–±–∞ –∏–≥—Ä–æ–∫–∞ –≥–æ—Ç–æ–≤—ã, —Å–¥–µ–ª–∞–π—Ç–µ –≤–∞—à –≤—ã–±–æ—Ä! –ü–æ—Å–ª–µ –∏–≥—Ä—ã –∫–æ–º–Ω–∞—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è.
        </p>
        
        <!-- –ö–Ω–æ–ø–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PWA -->
        <button id="install-btn" class="install-btn" style="display: none;">
          üì± –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        </button>
        
        <div class="pwa-features">
          <p class="features-text">
            ‚ö° <strong>PWA –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:</strong>
            ‚Ä¢ –†–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ–ª–∞–π–Ω ‚Ä¢ –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ ‚Ä¢ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ ‚Ä¢ Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Supabase -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script> 
  <script src="script.js"></script>
  
  <!-- PWA Service Worker -->
  <script>
    // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker –¥–ª—è PWA —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', async () => {
        try {
          const registration = await navigator.serviceWorker.register('/sw.js');
          console.log('‚úÖ Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', registration.scope);
          
          // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π SW
          registration.addEventListener('updatefound', () => {
            const newWorker = registration.installing;
            newWorker.addEventListener('statechange', () => {
              if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                // –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞
                if (confirm('–î–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å?')) {
                  newWorker.postMessage({ type: 'SKIP_WAITING' });
                  window.location.reload();
                }
              }
            });
          });
          
        } catch (error) {
          console.error('‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker:', error);
        }
      });

      // –°–ª—É—à–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç Service Worker
      navigator.serviceWorker.addEventListener('message', (event) => {
        if (event.data && event.data.type === 'SW_UPDATED') {
          console.log('üîÑ Service Worker –æ–±–Ω–æ–≤–ª–µ–Ω');
        }
      });
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
    let deferredPrompt;
    
    window.addEventListener('beforeinstallprompt', (e) => {
      console.log('üíæ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å');
      e.preventDefault();
      deferredPrompt = e;
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
      const installBtn = document.getElementById('install-btn');
      if (installBtn) {
        installBtn.style.display = 'block';
        installBtn.addEventListener('click', () => {
          installBtn.style.display = 'none';
          deferredPrompt.prompt();
          deferredPrompt.userChoice.then((choiceResult) => {
            if (choiceResult.outcome === 'accepted') {
              console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å—Ç–∞–Ω–æ–≤–∏–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ');
            } else {
              console.log('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª–æ–Ω–∏–ª —É—Å—Ç–∞–Ω–æ–≤–∫—É');
            }
            deferredPrompt = null;
          });
        });
      }
    });

    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
    window.addEventListener('appinstalled', (e) => {
      console.log('üéâ PWA –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!');
      // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —É—Å—Ç–∞–Ω–æ–≤–∫–∏
      const installBtn = document.getElementById('install-btn');
      if (installBtn) {
        installBtn.style.display = 'none';
      }
    });

    // –ü–æ–∫–∞–∑ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    window.addEventListener('online', () => {
      console.log('üåê –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
    });

    window.addEventListener('offline', () => {
      console.log('üì° –†–∞–±–æ—Ç–∞ –≤ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–µ');
      // –ú–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    });
  </script>
</body>
</html>
